<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LÃ¦rbarXR Builder</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
Â  --bg:#f8f9fa;
Â  --surface:#ffffff;
Â  --border:#e1e4e8;
Â  --text:#24292f;
Â  --accent:#0969da;
Â  --accent-hover:#0860ca;
Â  --green:#1a7f37;
Â  --red:#d1242f;
Â  --muted:#6e7781;
Â  --grid:#e8eaed;
Â  --shadow:0 1px 3px rgba(31,35,40,0.12);
Â  --shadow-lg:0 8px 24px rgba(140,149,159,0.2);
}
body{
Â  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
Â  background:var(--bg);color:var(--text);height:100vh;overflow:hidden
}

/* Layout */
.app{display:flex;height:100vh}
.panel{width:420px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;box-shadow:var(--shadow)}
.canvas-wrap{flex:1;position:relative;overflow:hidden;background:var(--bg)}
.canvas{
Â  width:100%;height:100%;position:relative;
Â  background-image:radial-gradient(circle,#d4d4d8 1px,transparent 1px);
Â  background-size:20px 20px;
}

/* Panel Sections */
.panel-header{padding:20px;border-bottom:1px solid var(--border)}
.panel-header h1{font-size:20px;font-weight:600;margin-bottom:12px}
.panel-tools{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;gap:8px;background:#fafbfc}
.panel-content{flex:1;overflow-y:auto;padding:16px}
.panel-footer{padding:16px;border-top:1px solid var(--border);background:#fafbfc}

/* Inspector */
.inspector{display:none;animation:slideIn 0.3s ease}
.inspector.active{display:block}
@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* Buttons & Inputs */
.btn{
Â  background:var(--accent);border:none;border-radius:6px;padding:8px 16px;
Â  color:#fff;cursor:pointer;font-size:13px;font-weight:500;
Â  transition:all 0.2s;display:inline-flex;align-items:center;gap:6px
}
.btn:hover{background:var(--accent-hover);transform:translateY(-1px);box-shadow:var(--shadow)}
.btn.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
.btn.secondary:hover{background:#f6f8fa;border-color:var(--accent)}
.btn.mini{padding:6px 12px;font-size:12px}
.btn.danger{background:var(--red)}
.btn.success{background:var(--green)}
.btn:disabled{opacity:0.5;cursor:not-allowed}

input,textarea,select{
Â  width:100%;background:var(--surface);border:1px solid var(--border);
Â  border-radius:6px;padding:8px 12px;color:var(--text);font-size:13px;
Â  transition:border 0.2s
}
input:focus,textarea:focus,select:focus{
Â  outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(9,105,218,0.1)
}
label{
Â  display:block;margin:0 0 6px;font-size:12px;font-weight:600;color:var(--text)
}

.field-group{
Â  background:var(--surface);border:1px solid var(--border);
Â  border-radius:8px;padding:16px;margin-bottom:16px
}
.field-group h3{font-size:14px;font-weight:600;margin-bottom:12px;color:var(--text)}

/* Nodes */
.node{
Â  position:absolute;width:160px;height:120px;border-radius:12px;
Â  background:var(--surface);border:2px solid var(--border);
Â  cursor:move;transition:all 0.2s;overflow:hidden;box-shadow:var(--shadow)
}
.node:hover{transform:scale(1.02);box-shadow:var(--shadow-lg)}
.node.selected{
Â  border-color:var(--accent);
Â  box-shadow:0 0 0 3px rgba(9,105,218,0.1),var(--shadow-lg)
}
.node.start{border-color:var(--green)}

.node-thumb{
Â  position:absolute;inset:0;background-size:cover;
Â  background-position:center;opacity:0.3
}
.node-content{
Â  position:relative;height:100%;display:flex;flex-direction:column;
Â  padding:12px
}
.node-title{font-size:13px;font-weight:600;margin-bottom:4px}
.node-type{font-size:11px;color:var(--muted);margin-bottom:8px}
.node-icons{
Â  position:absolute;bottom:8px;left:12px;display:flex;gap:4px;
Â  font-size:14px
}
.node-badge{
Â  position:absolute;top:8px;right:8px;background:var(--green);
Â  color:#fff;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600
}

/* Connections */
.connection{position:absolute;pointer-events:none;z-index:1;overflow:visible}
.connection path{
Â  fill:none;
Â  stroke:var(--border);
Â  stroke-width:3; /* Thicker */
Â  opacity:0.7;
Â  stroke-linecap:round;
}
.connection.default path{
Â  stroke:var(--muted);
Â  stroke-dasharray: 4 4; /* Dashed for default */
Â  animation: dash-flow 1s linear infinite;
}
.connection.correct path{stroke:var(--green);stroke-width:4}
.connection.incorrect path{stroke:var(--red);stroke-width:3;stroke-dasharray:5,5}

@keyframes dash-flow {
Â  to { stroke-dashoffset: -20; }
}

/* Add Menu */
.add-menu{position:fixed;bottom:24px;right:24px;z-index:100}
.add-btn{
Â  width:56px;height:56px;border-radius:50%;background:var(--accent);
Â  border:none;color:#fff;font-size:24px;cursor:pointer;
Â  box-shadow:0 4px 12px rgba(9,105,218,0.3);transition:all 0.3s
}
.add-btn:hover{transform:rotate(90deg) scale(1.1);background:var(--accent-hover)}
.add-options{
Â  position:absolute;bottom:70px;right:0;display:none;
Â  flex-direction:column;gap:8px;min-width:150px
}
.add-options.show{display:flex}
.add-opt{
Â  background:var(--surface);border:1px solid var(--border);
Â  padding:10px 16px;border-radius:8px;white-space:nowrap;
Â  cursor:pointer;font-size:13px;box-shadow:var(--shadow);
Â  transition:all 0.2s
}
.add-opt:hover{
Â  background:var(--accent);color:#fff;transform:translateX(-4px)
}

/* Quick Actions */
.quick-actions{display:flex;gap:8px;margin-top:12px}
.action-btn{
Â  flex:1;padding:8px;border:1px solid var(--border);border-radius:6px;
Â  background:var(--surface);color:var(--text);font-size:12px;
Â  cursor:pointer;transition:all 0.2s
}
.action-btn:hover{background:#f6f8fa;border-color:var(--accent)}

/* Media Grid */
.media-grid{
Â  display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px
}
.media-item{
Â  aspect-ratio:16/9;background:#f6f8fa;border:2px solid var(--border);
Â  border-radius:6px;position:relative;overflow:hidden;cursor:pointer;
Â  transition:all 0.2s
}
.media-item img{width:100%;height:100%;object-fit:cover}
.media-item.selected{border-color:var(--accent);box-shadow:0 0 0 2px rgba(9,105,218,0.1)}
.media-item:hover{transform:scale(1.05)}

/* Text Overlays */
.text-overlays{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.text-overlay-item{
Â  background:#f6f8fa;border:1px solid var(--border);
Â  border-radius:6px;padding:10px;display:flex;flex-direction:column;gap:8px
}
.text-overlay-controls{display:flex;gap:8px;align-items:center}
.text-overlay-controls input[type="number"]{width:80px}
.text-overlay-controls select{width:100px}
.text-overlay-remove{
Â  background:var(--red);border:none;color:#fff;
Â  padding:4px 8px;border-radius:4px;cursor:pointer;
Â  font-size:11px;transition:all 0.2s
}
.text-overlay-remove:hover{background:#b91c1c}

/* Color preview */
.color-preview{
Â  width:24px;height:24px;border-radius:4px;
Â  border:1px solid var(--border);margin-left:4px
}

/* Preview Modal */
.preview-modal{
Â  position:fixed;inset:0;background:rgba(0,0,0,0.5);
Â  display:none;align-items:center;justify-content:center;z-index:1000
}
.preview-modal.show{display:flex}
.preview-content{
Â  background:var(--surface);border-radius:12px;
Â  width:90%;max-width:900px;height:80vh;
Â  display:flex;flex-direction:column;box-shadow:var(--shadow-lg)
}
.preview-header{
Â  padding:20px;border-bottom:1px solid var(--border);
Â  display:flex;justify-content:space-between;align-items:center
}
.preview-header h2{font-size:18px;font-weight:600}
.preview-body{
Â  flex:1;display:flex;flex-direction:column;
Â  align-items:center;justify-content:center;
Â  padding:20px;overflow:auto;position:relative
}
.preview-video{
Â  width:100%;max-width:640px;max-height:360px;
Â  background:#000;border-radius:8px;margin-bottom:20px
}
.preview-content-section{
Â  width:100%;max-width:640px;margin-bottom:20px
}
.preview-images{
Â  display:flex;gap:12px;flex-wrap:wrap;justify-content:center;
Â  margin-bottom:16px
}
.preview-images img{
Â  width:120px;height:80px;object-fit:cover;
Â  border-radius:6px;box-shadow:var(--shadow)
}
.preview-text-overlay{
Â  position:absolute;top:40px;left:50%;transform:translateX(-50%);
Â  padding:16px 20px;border-radius:8px;color:#fff;
Â  font-size:14px;font-weight:500;max-width:500px;
Â  box-shadow:var(--shadow-lg);display:none;text-align:center;
Â  background:rgba(0,0,0,0.7);
Â  transition: opacity 0.3s;
}
.preview-text-overlay.show{display:block; opacity:1;}
.preview-text-overlay img {
Â  max-width: 100%;
Â  max-height: 120px;
Â  border-radius: 4px;
Â  margin-bottom: 8px;
Â  display: block;
Â  margin-left: auto;
Â  margin-right: auto;
}
.preview-question{
Â  font-size:16px;font-weight:600;margin-bottom:16px;
Â  text-align:center
}
.preview-choices{
Â  display:flex;flex-direction:column;gap:8px;
Â  width:100%;max-width:400px;margin:0 auto
}
.preview-choice{
Â  background:var(--surface);border:2px solid var(--border);
Â  padding:12px 16px;border-radius:8px;cursor:pointer;
Â  transition:all 0.2s;text-align:center;font-size:14px
}
.preview-choice:hover{
Â  background:#f6f8fa;border-color:var(--accent);
Â  transform:translateY(-2px);box-shadow:var(--shadow)
}
.preview-choice.correct{border-color:var(--green);background:#f0fdf4}
.preview-choice.incorrect{border-color:var(--red);background:#fef2f2}
.preview-nav{
Â  padding:20px;border-top:1px solid var(--border);
Â  display:flex;justify-content:center;gap:12px
}

/* Choice Builder */
.choices-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.choice-item{
Â  background:#f6f8fa;border:1px solid var(--border);
Â  border-radius:6px;padding:10px;display:flex;align-items:center;gap:8px
}
.choice-item input[type="checkbox"]{width:auto;margin-right:4px}
.choice-item input[type="text"]{flex:1}
.choice-item select{width:auto;min-width:120px}
.choice-remove{
Â  background:var(--red);border:none;color:#fff;
Â  padding:4px 8px;border-radius:4px;cursor:pointer;
Â  font-size:11px;transition:all 0.2s;white-space:nowrap
}
.choice-remove:hover{background:#b91c1c}

/* Status */
.status{
Â  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
Â  background:var(--text);color:#fff;padding:12px 20px;
Â  border-radius:8px;display:none;z-index:1001;box-shadow:var(--shadow-lg)
}
.status.show{display:block}

/* Asset Counter */
.asset-counter{
Â  background:#f6f8fa;border:1px solid var(--border);
Â  border-radius:6px;padding:8px 12px;margin-top:8px;
Â  font-size:12px;display:flex;justify-content:space-between
}
.asset-count{color:var(--muted)}
</style>
</head>
<body>
<div class="app">
Â  <div class="panel">
Â  Â  <div class="panel-header">
Â  Â  Â  <h1>ğŸ¬ LÃ¦rbarXR Builder</h1>
Â  Â  Â  <input id="projectTitle" placeholder="Enter project title..." value="My 360Â° Scenario">
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="panel-tools">
Â  Â  Â  <button class="btn secondary mini" onclick="App.preview()">â–¶ Preview</button>
Â  Â  Â  <button class="btn secondary mini" onclick="App.save()">ğŸ’¾ Save</button>
Â  Â  Â  <button class="btn secondary mini" onclick="App.load()">ğŸ“ Load</button>
Â  Â  Â  <input type="file" id="loader" accept=".lxr" style="display:none" onchange="App.loadFile(event)">
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="panel-content">
Â  Â  Â  <div id="inspector" class="inspector"></div>
Â  Â  Â Â 
Â  Â  Â  <div id="defaultView">
Â  Â  Â  Â  <div class="field-group">
Â  Â  Â  Â  Â  <h3>ğŸš€ Quick Start</h3>
Â  Â  Â  Â  Â  <p style="font-size:12px;color:var(--muted);margin-bottom:12px;line-height:1.5">
Â  Â  Â  Â  Â  Â  Build immersive 360Â° experiences. Each video can have questions with answer-based navigation and timed text overlays.
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  <button class="btn" style="width:100%" onclick="App.addNode('video')">
Â  Â  Â  Â  Â  Â  + Add First Video Node
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="field-group">
Â  Â  Â  Â  Â  <h3>ğŸ“¦ Assets Library</h3>
Â  Â  Â  Â  Â  <div class="quick-actions">
Â  Â  Â  Â  Â  Â  <input type="file" id="videoFiles" accept="video/mp4" multiple style="display:none" onchange="App.addVideos(event)">
Â  Â  Â  Â  Â  Â  <input type="file" id="imageFiles" accept="image/*" multiple style="display:none" onchange="App.addImages(event)">
Â  Â  Â  Â  Â  Â  <button class="action-btn" onclick="document.getElementById('videoFiles').click()">ğŸ“¹ Add Videos</button>
Â  Â  Â  Â  Â  Â  <button class="action-btn" onclick="document.getElementById('imageFiles').click()">ğŸ–¼ Add Images</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="asset-counter">
Â  Â  Â  Â  Â  Â  <span class="asset-count">Videos: <strong id="videoCount">0</strong></span>
Â  Â  Â  Â  Â  Â  <span class="asset-count">Images: <strong id="imageCount">0</strong></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="field-group">
Â  Â  Â  Â  Â  <h3>ğŸ“Š Project Stats</h3>
Â  Â  Â  Â  Â  <div style="font-size:12px;color:var(--muted);line-height:1.8">
Â  Â  Â  Â  Â  Â  Nodes: <strong id="nodeCount">0</strong><br>
Â  Â  Â  Â  Â  Â  Connections: <strong id="connectionCount">0</strong>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="panel-footer">
Â  Â  Â  <button class="btn success" style="width:100%" onclick="App.export()">
Â  Â  Â  Â  ğŸ“¦ Export WebXR Package
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
Â Â 
Â  <div class="canvas-wrap">
Â  Â  <div id="canvas" class="canvas"></div>
Â  Â Â 
Â  Â  <div class="add-menu">
Â  Â  Â  <div id="addOptions" class="add-options">
Â  Â  Â  Â  <div class="add-opt" onclick="App.addNode('video')">ğŸ¥ Video Node</div>
Â  Â  Â  Â  <div class="add-opt" onclick="App.addNode('end')">ğŸ End Node</div>
Â  Â  Â  </div>
Â  Â  Â  <button class="add-btn" onclick="App.toggleAddMenu()">+</button>
Â  Â  </div>
Â  </div>
</div>

<!-- Preview Modal -->
<div class="preview-modal" id="previewModal">
Â  <div class="preview-content">
Â  Â  <div class="preview-header">
Â  Â  Â  <h2 id="previewTitle">Preview</h2>
Â  Â  Â  <button class="btn secondary" onclick="App.closePreview()">Close</button>
Â  Â  </div>
Â  Â  <div class="preview-body" id="previewBody">
Â  Â  Â  <!-- Dynamic preview content -->
Â  Â  </div>
Â  Â  <div class="preview-nav" id="previewNav">
Â  Â  Â  <!-- Navigation buttons -->
Â  Â  </div>
Â  </div>
</div>

<div class="status" id="status"></div>

<script>
const App = {
Â  project: {
Â  Â  title: "My 360Â° Scenario",
Â  Â  startNode: null,
Â  Â  nodes: [],
Â  Â  connections: [],
Â  Â  assets: { videos: [], images: [] }
Â  },
Â Â 
Â  selectedNode: null,
Â  dragging: null,
Â  dragOffset: {x:0, y:0},
Â  previewState: {
Â  Â  currentNode: null,
Â  Â  history: [],
Â  Â  videoTime: 0,
Â  Â  overlayTimer: null,
Â  Â  videoTimeUpdater: null // For tracking video timeupdate listener
Â  },
Â Â 
Â  init: function() {
Â  Â  var self = this;
Â  Â  document.getElementById('canvas').addEventListener('click', function(e) {
Â  Â  Â  if(e.target.id === 'canvas') self.deselect();
Â  Â  });
Â  Â Â 
Â  Â  document.getElementById('projectTitle').addEventListener('input', function(e) {
Â  Â  Â  self.project.title = e.target.value;
Â  Â  });
Â  Â Â 
Â  Â  document.addEventListener('keydown', function(e) {
Â  Â  Â  if(e.key === 'Delete' && self.selectedNode) {
Â  Â  Â  Â  self.deleteNode(self.selectedNode);
Â  Â  Â  }
Â  Â  });
Â  Â Â 
Â  Â  // Start with a video node
Â  Â  this.addNode('video', 100, 150);
Â  Â  this.updateStats();
Â  },
Â Â 
Â  addNode: function(type, x, y) {
Â  Â  x = x || 100 + Math.random() * 600;
Â  Â  y = y || 100 + Math.random() * 400;
Â  Â Â 
Â  Â  var node = {
Â  Â  Â  id: 'node_' + Date.now() + Math.random().toString(36).substr(2,4),
Â  Â  Â  type: type,
Â  Â  Â  x: x,
Â  Â  Â  y: y,
Â  Â  Â  title: type === 'video' ? 'Video Scene' : 'End Scene',
Â  Â  Â Â 
Â  Â  Â  // Content
Â  Â  Â  video: null,
Â  Â  Â  images: [],
Â  Â  Â  textOverlays: [], // Array of {time, duration, text, color, image}
Â  Â  Â  question: '',
Â  Â  Â  choices: [], // Answer choices with navigation
Â  Â  Â Â 
Â  Â  Â  duration: 10,
Â  Â  Â  defaultNext: null, // Default next node if no question/choice
Â  Â  Â  outcome: type === 'end' ? 'complete' : null
Â  Â  };
Â  Â Â 
Â  Â  this.project.nodes.push(node);
Â  Â  if(!this.project.startNode) this.project.startNode = node.id;
Â  Â Â 
Â  Â  this.createNodeElement(node);
Â  Â  this.updateCanvas();
Â  Â  this.updateStats();
Â  Â  return node;
Â  },
Â Â 
Â  createNodeElement: function(node) {
Â  Â  var el = document.createElement('div');
Â  Â  el.className = 'node';
Â  Â  if(this.project.startNode === node.id) el.className += ' start';
Â  Â  el.id = node.id;
Â  Â  el.style.left = node.x + 'px';
Â  Â  el.style.top = node.y + 'px';
Â  Â Â 
Â  Â  var thumb = '';
Â  Â  if(node.video) {
Â  Â  Â  var asset = this.project.assets.videos.find(function(v) { return v.id === node.video; });
Â  Â  Â  if(asset && asset.thumb) {
Â  Â  Â  Â  thumb = '<div class="node-thumb" style="background-image:url(\'' + asset.thumb + '\')"></div>';
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  var icons = [];
Â  Â  if(node.video) icons.push('ğŸ¬');
Â  Â  if(node.images.length) icons.push('ğŸ–¼');
Â  Â  if(node.textOverlays && node.textOverlays.length) icons.push('ğŸ“');
Â  Â  if(node.question || node.choices.length) icons.push('â“');
Â  Â Â 
Â  Â  var iconsHtml = icons.length ? '<div class="node-icons">' + icons.join(' ') + '</div>' : '';
Â  Â  var badge = this.project.startNode === node.id ? '<div class="node-badge">START</div>' : '';
Â  Â Â 
Â  Â  el.innerHTML = thumb +
Â  Â  Â  '<div class="node-content">' +
Â  Â  Â  Â  '<div class="node-title">' + node.title + '</div>' +
Â  Â  Â  Â  '<div class="node-type">' + node.type.toUpperCase() + '</div>' +
Â  Â  Â  Â  iconsHtml +
Â  Â  Â  '</div>' +
Â  Â  Â  badge;
Â  Â Â 
Â  Â  var self = this;
Â  Â  el.addEventListener('mousedown', function(e) { self.startDrag(e, node); });
Â  Â  el.addEventListener('click', function(e) {
Â  Â  Â  e.stopPropagation();
Â  Â  Â  self.selectNode(node);
Â  Â  });
Â  Â Â 
Â  Â  document.getElementById('canvas').appendChild(el);
Â  },
Â Â 
Â  selectNode: function(node) {
Â  Â  var nodes = document.querySelectorAll('.node');
Â  Â  for(var i = 0; i < nodes.length; i++) {
Â  Â  Â  nodes[i].classList.remove('selected');
Â  Â  }
Â  Â  document.getElementById(node.id).classList.add('selected');
Â  Â  this.selectedNode = node;
Â  Â  this.showInspector(node);
Â  },
Â Â 
Â  deselect: function() {
Â  Â  var nodes = document.querySelectorAll('.node');
Â  Â  for(var i = 0; i < nodes.length; i++) {
Â  Â  Â  nodes[i].classList.remove('selected');
Â  Â  }
Â  Â  this.selectedNode = null;
Â  Â  document.getElementById('inspector').classList.remove('active');
Â  Â  document.getElementById('defaultView').style.display = 'block';
Â  },
Â Â 
Â  showInspector: function(node) {
Â  Â  var inspector = document.getElementById('inspector');
Â  Â  document.getElementById('defaultView').style.display = 'none';
Â  Â Â 
Â  Â  var html = '<div class="field-group">';
Â  Â  html += '<h3>ğŸ“ ' + node.type.charAt(0).toUpperCase() + node.type.slice(1) + ' Properties</h3>';
Â  Â  html += '<label>Title</label>';
Â  Â  html += '<input value="' + node.title + '" onchange="App.updateNode(\'title\', this.value)">';
Â  Â Â 
Â  Â  if(node.type !== 'end') {
Â  Â  Â  html += '<label>Duration (seconds)</label>';
Â  Â  Â  html += '<input type="number" value="' + node.duration + '" onchange="App.updateNode(\'duration\', this.value)">';
Â  Â  }
Â  Â  html += '</div>';
Â  Â Â 
Â  Â  if(node.type !== 'end') {
Â  Â  Â  // Media Section
Â  Â  Â  html += '<div class="field-group">';
Â  Â  Â  html += '<h3>ğŸ¨ Media</h3>';
Â  Â  Â Â 
Â  Â  Â  html += '<label>360Â° Video</label>';
Â  Â  Â  html += '<select onchange="App.updateNode(\'video\', this.value)">';
Â  Â  Â  html += '<option value="">No video</option>';
Â  Â  Â  for(var i = 0; i < this.project.assets.videos.length; i++) {
Â  Â  Â  Â  var v = this.project.assets.videos[i];
Â  Â  Â  Â  html += '<option value="' + v.id + '"' + (node.video === v.id ? ' selected' : '') + '>' + v.name + '</option>';
Â  Â  Â  }
Â  Â  Â  html += '</select>';
Â  Â  Â Â 
Â  Â  Â  html += '<label style="margin-top:12px">Overlay Images</label>';
Â  Â  Â  html += '<div class="media-grid">';
Â  Â  Â  for(var j = 0; j < this.project.assets.images.length; j++) {
Â  Â  Â  Â  var img = this.project.assets.images[j];
Â  Â  Â  Â  var selected = node.images.indexOf(img.id) >= 0 ? ' selected' : '';
Â  Â  Â  Â  html += '<div class="media-item' + selected + '" onclick="App.toggleImage(\'' + img.id + '\')">';
Â  Â  Â  Â  html += '<img src="' + img.url + '">';
Â  Â  Â  Â  html += '</div>';
Â  Â  Â  }
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â Â 
Â  Â  Â  // Text Overlays Section
Â  Â  Â  html += '<div class="field-group">';
Â  Â  Â  html += '<h3>ğŸ“± Text Overlays</h3>';
Â  Â  Â  html += '<div class="text-overlays">';
Â  Â  Â Â 
Â  Â  Â  if(node.textOverlays) {
Â  Â  Â  Â  for(var t = 0; t < node.textOverlays.length; t++) {
Â  Â  Â  Â  Â  var overlay = node.textOverlays[t];
Â  Â  Â  Â  Â  html += '<div class="text-overlay-item">';
Â  Â  Â  Â  Â  html += '<textarea rows="2" placeholder="Text content..." onchange="App.updateTextOverlay(' + t + ', \'text\', this.value)">' + (overlay.text || '') + '</textarea>';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Time controls
Â  Â  Â  Â  Â  html += '<div class="text-overlay-controls" style="margin-top:8px;">';
Â  Â  Â  Â  Â  html += '<label style="margin:0">Time:</label>';
Â  Â  Â  Â  Â  html += '<input type="number" value="' + (overlay.time || 0) + '" min="0" step="0.5" onchange="App.updateTextOverlay(' + t + ', \'time\', this.value)" style="width:70px"> sec';
Â  Â  Â  Â  Â  html += '<label style="margin:0; margin-left:8px;">Dur:</label>';
Â  Â  Â  Â  Â  html += '<input type="number" value="' + (overlay.duration || 3) + '" min="0.5" step="0.5" onchange="App.updateTextOverlay(' + t + ', \'duration\', this.value)" style="width:60px"> sec';
Â  Â  Â  Â  Â  html += '</div>';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Image and Style controls
Â  Â  Â  Â  Â  html += '<div class="text-overlay-controls" style="margin-top:8px;">';
Â  Â  Â  Â  Â  html += '<label style="margin:0">Img:</label>';
Â  Â  Â  Â  Â  html += '<select onchange="App.updateTextOverlay(' + t + ', \'image\', this.value)" style="flex:1;min-width:80px;width:auto;">';
Â  Â  Â  Â  Â  html += '<option value="">None</option>';
Â  Â  Â  Â  Â  for(var imgIdx = 0; imgIdx < this.project.assets.images.length; imgIdx++) {
Â  Â  Â  Â  Â  Â  Â  var imgAsset = this.project.assets.images[imgIdx];
Â  Â  Â  Â  Â  Â  Â  html += '<option value="' + imgAsset.id + '"' + (overlay.image === imgAsset.id ? ' selected' : '') + '>' + imgAsset.name + '</option>';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  html += '</select>';
Â  Â  Â  Â  Â  html += '<select onchange="App.updateTextOverlay(' + t + ', \'color\', this.value)" style="width:auto;margin-left:8px;">';
Â  Â  Â  Â  Â  html += '<option value="#424242"' + (overlay.color === '#424242' ? ' selected' : '') + '>Dark</option>';
Â  Â  Â  Â  Â  html += '<option value="#FF5252"' + (overlay.color === '#FF5252' ? ' selected' : '') + '>Red</option>';
Â  Â  Â  Â  Â  html += '<option value="#448AFF"' + (overlay.color === '#448AFF' ? ' selected' : '') + '>Blue</option>';
Â  Â  Â  Â  Â  html += '<option value="#69F0AE"' + (overlay.color === '#69F0AE' ? ' selected' : '') + '>Green</option>';
Â  Â  Â  Â  Â  html += '<option value="#FFD740"' + (overlay.color === '#FFD740' ? ' selected' : '') + '>Yellow</option>';
Â  Â  Â  Â  Â  html += '<option value="#E040FB"' + (overlay.color === '#E040FB' ? ' selected' : '') + '>Purple</option>';
Â  Â  Â  Â  Â  html += '<option value="#FF6E40"' + (overlay.color === '#FF6E40' ? ' selected' : '') + '>Orange</option>';
Â  Â  Â  Â  Â  html += '</select>';
Â  Â  Â  Â  Â  html += '<div class="color-preview" style="background:' + (overlay.color || '#424242') + '"></div>';
Â  Â  Â  Â  Â  html += '<button class="text-overlay-remove" onclick="App.removeTextOverlay(' + t + ')" style="margin-left:8px;">Ã—</button>';
Â  Â  Â  Â  Â  html += '</div>'; // close text-overlay-controls
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  html += '</div>'; // close text-overlay-item
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '<button class="btn secondary mini" style="width:100%" onclick="App.addTextOverlay()">+ Add Text Overlay</button>';
Â  Â  Â  html += '</div>';
Â  Â  Â Â 
Â  Â  Â  // Question Section
Â  Â  Â  html += '<div class="field-group">';
Â  Â  Â  html += '<h3>â“ Question & Navigation</h3>';
Â  Â  Â  html += '<label>Question (optional)</label>';
Â  Â  Â  html += '<textarea rows="3" placeholder="Ask a question to show answer choices..." onchange="App.updateNode(\'question\', this.value)">' + (node.question || '') + '</textarea>';
Â  Â  Â Â 
Â  Â  Â  if(node.question) {
Â  Â  Â  Â  html += '<label style="margin-top:12px">Answer Choices</label>';
Â  Â  Â  Â  html += '<div class="choices-list">';
Â  Â  Â  Â Â 
Â  Â  Â  Â  for(var k = 0; k < node.choices.length; k++) {
Â  Â  Â  Â  Â  var c = node.choices[k];
Â  Â  Â  Â  Â  html += '<div class="choice-item">';
Â  Â  Â  Â  Â  html += '<input type="checkbox" title="Correct answer"' + (c.correct ? ' checked' : '') +Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  ' onchange="App.updateChoice(' + k + ', \'correct\', this.checked)">';
Â  Â  Â  Â  Â  html += '<input type="text" value="' + c.label + '" placeholder="Answer text..." ' +
Â  Â  Â  Â  Â  Â  Â  Â  Â  'onchange="App.updateChoice(' + k + ', \'label\', this.value)">';
Â  Â  Â  Â  Â  html += '<select title="Navigate to" onchange="App.updateChoice(' + k + ', \'target\', this.value)">';
Â  Â  Â  Â  Â  html += '<option value="">â†’ Default</option>';
Â  Â  Â  Â  Â  for(var m = 0; m < this.project.nodes.length; m++) {
Â  Â  Â  Â  Â  Â  var n = this.project.nodes[m];
Â  Â  Â  Â  Â  Â  if(n.id !== node.id) {
Â  Â  Â  Â  Â  Â  Â  html += '<option value="' + n.id + '"' + (c.target === n.id ? ' selected' : '') + '>' + n.title + '</option>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  html += '</select>';
Â  Â  Â  Â  Â  html += '<button class="choice-remove" onclick="App.removeChoice(' + k + ')">Ã—</button>';
Â  Â  Â  Â  Â  html += '</div>';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  html += '</div>';
Â  Â  Â  Â  html += '<button class="btn secondary mini" style="width:100%" onclick="App.addChoice()">+ Add Choice</button>';
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  html += '<label style="margin-top:12px">Default Next Node (no question/timeout)</label>';
Â  Â  Â  html += '<select onchange="App.updateNode(\'defaultNext\', this.value)">';
Â  Â  Â  html += '<option value="">None (End)</option>';
Â  Â  Â  for(var q = 0; q < this.project.nodes.length; q++) {
Â  Â  Â  Â  var nav = this.project.nodes[q];
Â  Â  Â  Â  if(nav.id !== node.id) {
Â  Â  Â  Â  Â  html += '<option value="' + nav.id + '"' + (node.defaultNext === nav.id ? ' selected' : '') + '>' + nav.title + '</option>';
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  html += '</select>';
Â  Â  Â  html += '</div>';
Â  Â  }
Â  Â Â 
Â  Â  html += '<div class="field-group">';
Â  Â  html += '<h3>âš¡ Actions</h3>';
Â  Â  html += '<div class="quick-actions">';
Â  Â  html += '<button class="action-btn" onclick="App.duplicateNode()">ğŸ“‹ Duplicate</button>';
Â  Â  html += '<button class="action-btn" onclick="App.deleteNode()" style="color:var(--red)">ğŸ—‘ Delete</button>';
Â  Â  if(this.project.startNode !== node.id) {
Â  Â  Â  html += '<button class="action-btn" onclick="App.setStart()">ğŸš€ Set Start</button>';
Â  Â  }
Â  Â  html += '</div>';
Â  Â  html += '</div>';
Â  Â Â 
Â  Â  inspector.innerHTML = html;
Â  Â  inspector.classList.add('active');
Â  },
Â Â 
Â  updateNode: function(prop, value) {
Â  Â  if(!this.selectedNode) return;
Â  Â  this.selectedNode[prop] = prop === 'duration' ? parseInt(value) : value;
Â  Â Â 
Â  Â  // If question is set/cleared, ensure choices array exists
Â  Â  if(prop === 'question') {
Â  Â  Â  if(value && !this.selectedNode.choices) {
Â  Â  Â  Â  this.selectedNode.choices = [];
Â  Â  Â  Â  // Add two default choices
Â  Â  Â  Â  this.selectedNode.choices.push({
Â  Â  Â  Â  Â  id: 'c' + Date.now() + '1',
Â  Â  Â  Â  Â  label: 'Option A',
Â  Â  Â  Â  Â  correct: true,
Â  Â  Â  Â  Â  target: null
Â  Â  Â  Â  });
Â  Â  Â  Â  this.selectedNode.choices.push({
Â  Â  Â  Â  Â  id: 'c' + Date.now() + '2',
Â  Â  Â  Â  Â  label: 'Option B',
Â  Â  Â  Â  Â  correct: false,
Â  Â  Â  Â  Â  target: null
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  this.showInspector(this.selectedNode);
Â  Â  }
Â  Â Â 
Â  Â  this.updateNodeElement(this.selectedNode);
Â  Â  this.updateCanvas();
Â  },
Â Â 
Â  toggleImage: function(imgId) {
Â  Â  if(!this.selectedNode) return;
Â  Â  var idx = this.selectedNode.images.indexOf(imgId);
Â  Â  if(idx >= 0) {
Â  Â  Â  this.selectedNode.images.splice(idx, 1);
Â  Â  } else {
Â  Â  Â  this.selectedNode.images.push(imgId);
Â  Â  }
Â  Â  this.showInspector(this.selectedNode);
Â  Â  this.updateNodeElement(this.selectedNode);
Â  },
Â Â 
Â  addTextOverlay: function() {
Â  Â  if(!this.selectedNode) return;
Â  Â  if(!this.selectedNode.textOverlays) this.selectedNode.textOverlays = [];
Â  Â Â 
Â  Â  this.selectedNode.textOverlays.push({
Â  Â  Â  time: 0,
Â  Â  Â  duration: 3, // New default
Â  Â  Â  text: '',
Â  Â  Â  color: '#424242', // New default
Â  Â  Â  image: null // New
Â  Â  });
Â  Â  this.showInspector(this.selectedNode);
Â  Â  this.updateNodeElement(this.selectedNode);
Â  },
Â Â 
Â  updateTextOverlay: function(idx, prop, value) {
Â  Â  if(!this.selectedNode || !this.selectedNode.textOverlays[idx]) return;
Â  Â Â 
Â  Â  if(prop === 'time') {
Â  Â  Â  value = parseFloat(value) || 0;
Â  Â  }
Â  Â  if(prop === 'duration') {
Â  Â  Â  value = parseFloat(value) || 0.5;
Â  Â  }
Â  Â  if(prop === 'image' && value === "") {
Â  Â  Â  value = null;
Â  Â  }
Â  Â Â 
Â  Â  this.selectedNode.textOverlays[idx][prop] = value;
Â  Â Â 
Â  Â  // Update color preview if it's a color change
Â  Â  if(prop === 'color') {
Â  Â  Â  this.showInspector(this.selectedNode);
Â  Â  }
Â  Â  this.updateNodeElement(this.selectedNode);
Â  },
Â Â 
Â  removeTextOverlay: function(idx) {
Â  Â  if(!this.selectedNode || !this.selectedNode.textOverlays) return;
Â  Â  this.selectedNode.textOverlays.splice(idx, 1);
Â  Â  this.showInspector(this.selectedNode);
Â  Â  this.updateNodeElement(this.selectedNode);
Â  },
Â Â 
Â  updateChoice: function(idx, prop, value) {
Â  Â  if(!this.selectedNode || !this.selectedNode.choices[idx]) return;
Â  Â  this.selectedNode.choices[idx][prop] = prop === 'correct' ? value : value;
Â  Â  this.updateCanvas();
Â  },
Â Â 
Â  addChoice: function() {
Â  Â  if(!this.selectedNode) return;
Â  Â  if(!this.selectedNode.choices) this.selectedNode.choices = [];
Â  Â  this.selectedNode.choices.push({
Â  Â  Â  id: 'c' + Date.now(),
Â  Â  Â  label: 'New Option',
Â  Â  Â  correct: false,
Â  Â  Â  target: null
Â  Â  });
Â  Â  this.showInspector(this.selectedNode);
Â  },
Â Â 
Â  removeChoice: function(idx) {
Â  Â  if(!this.selectedNode || !this.selectedNode.choices) return;
Â  Â  this.selectedNode.choices.splice(idx, 1);
Â  Â  this.showInspector(this.selectedNode);
Â  },
Â Â 
Â  updateNodeElement: function(node) {
Â  Â  var old = document.getElementById(node.id);
Â  Â  if(old) old.remove();
Â  Â  this.createNodeElement(node);
Â  Â  if(this.selectedNode && this.selectedNode.id === node.id) {
Â  Â  Â  document.getElementById(node.id).classList.add('selected');
Â  Â  }
Â  },
Â Â 
Â  deleteNode: function() {
Â  Â  if(!this.selectedNode) return;
Â  Â  var id = this.selectedNode.id;
Â  Â Â 
Â  Â  this.project.nodes = this.project.nodes.filter(function(n) { return n.id !== id; });
Â  Â  this.project.nodes.forEach(function(n) {
Â  Â  Â  if(n.defaultNext === id) n.defaultNext = null;
Â  Â  Â  if(n.choices) {
Â  Â  Â  Â  n.choices.forEach(function(c) {
Â  Â  Â  Â  Â  if(c.target === id) c.target = null;
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });
Â  Â Â 
Â  Â  var el = document.getElementById(id);
Â  Â  if(el) el.remove();
Â  Â Â 
Â  Â  if(this.project.startNode === id) {
Â  Â  Â  this.project.startNode = this.project.nodes[0] ? this.project.nodes[0].id : null;
Â  Â  }
Â  Â Â 
Â  Â  this.deselect();
Â  Â  this.updateCanvas();
Â  Â  this.updateStats();
Â  },
Â Â 
Â  setStart: function() {
Â  Â  if(!this.selectedNode) return;
Â  Â  this.project.startNode = this.selectedNode.id;
Â  Â  var nodes = document.querySelectorAll('.node');
Â  Â  for(var i = 0; i < nodes.length; i++) {
Â  Â  Â  nodes[i].classList.remove('start');
Â  Â  }
Â  Â  document.getElementById(this.selectedNode.id).classList.add('start');
Â  Â  this.showInspector(this.selectedNode);
Â  },
Â Â 
Â  duplicateNode: function() {
Â  Â  if(!this.selectedNode) return;
Â  Â  var copy = JSON.parse(JSON.stringify(this.selectedNode));
Â  Â  copy.id = 'node_' + Date.now() + Math.random().toString(36).substr(2,4);
Â  Â  copy.x += 60;
Â  Â  copy.y += 60;
Â  Â  copy.title += ' (Copy)';
Â  Â  // Reset choice IDs
Â  Â  if(copy.choices) {
Â  Â  Â  copy.choices.forEach(function(c) {
Â  Â  Â  Â  c.id = 'c' + Date.now() + Math.random().toString(36).substr(2,4);
Â  Â  Â  });
Â  Â  }
Â  Â  this.project.nodes.push(copy);
Â  Â  this.createNodeElement(copy);
Â  Â  this.updateCanvas();
Â  Â  this.updateStats();
Â  },
Â Â 
Â  startDrag: function(e, node) {
Â  Â  e.preventDefault();
Â  Â  this.dragging = node;
Â  Â  var rect = e.target.getBoundingClientRect();
Â  Â  this.dragOffset = {
Â  Â  Â  x: e.clientX - rect.left,
Â  Â  Â  y: e.clientY - rect.top
Â  Â  };
Â  Â Â 
Â  Â  var self = this;
Â  Â  var moveHandler = function(e) { self.onDrag(e); };
Â  Â  var upHandler = function() {
Â  Â  Â  self.dragging = null;
Â  Â  Â  document.removeEventListener('mousemove', moveHandler);
Â  Â  Â  document.removeEventListener('mouseup', upHandler);
Â  Â  };
Â  Â Â 
Â  Â  document.addEventListener('mousemove', moveHandler);
Â  Â  document.addEventListener('mouseup', upHandler);
Â  },
Â Â 
Â  onDrag: function(e) {
Â  Â  if(!this.dragging) return;
Â  Â  var canvas = document.getElementById('canvas').getBoundingClientRect();
Â  Â  this.dragging.x = e.clientX - canvas.left - this.dragOffset.x;
Â  Â  this.dragging.y = e.clientY - canvas.top - this.dragOffset.y;
Â  Â Â 
Â  Â  var el = document.getElementById(this.dragging.id);
Â  Â  el.style.left = this.dragging.x + 'px';
Â  Â  el.style.top = this.dragging.y + 'px';
Â  Â Â 
Â  Â  this.updateCanvas();
Â  },
Â Â 
Â  updateCanvas: function() {
Â  Â  var oldConns = document.querySelectorAll('.connection');
Â  Â  for(var i = 0; i < oldConns.length; i++) {
Â  Â  Â  oldConns[i].remove();
Â  Â  }
Â  Â Â 
Â  Â  var self = this;
Â  Â  var connectionCount = 0;
Â  Â Â 
Â  Â  this.project.nodes.forEach(function(node) {
Â  Â  Â  if(node.defaultNext) {
Â  Â  Â  Â  self.drawConnection(node.id, node.defaultNext, 'default');
Â  Â  Â  Â  connectionCount++;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if(node.choices) {
Â  Â  Â  Â  node.choices.forEach(function(choice) {
Â  Â  Â  Â  Â  if(choice.target) {
Â  Â  Â  Â  Â  Â  self.drawConnection(node.id, choice.target,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choice.correct ? 'correct' : 'incorrect');
Â  Â  Â  Â  Â  Â  connectionCount++;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });
Â  Â Â 
Â  Â  document.getElementById('connectionCount').textContent = connectionCount;
Â  },
Â Â 
Â  drawConnection: function(fromId, toId, type) {
Â  Â  var from = document.getElementById(fromId);
Â  Â  var to = document.getElementById(toId);
Â  Â  if(!from || !to) return;
Â  Â Â 
Â  Â  var canvas = document.getElementById('canvas');
Â  Â  var rect = canvas.getBoundingClientRect();
Â  Â Â 
Â  Â  var fromRect = from.getBoundingClientRect();
Â  Â  var toRect = to.getBoundingClientRect();
Â  Â Â 
Â  Â  var x1 = fromRect.left - rect.left + fromRect.width/2;
Â  Â  var y1 = fromRect.top - rect.top + fromRect.height/2;
Â  Â  var x2 = toRect.left - rect.left + toRect.width/2;
Â  Â  var y2 = toRect.top - rect.top + toRect.height/2;
Â  Â Â 
Â  Â  var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
Â  Â  svg.className = 'connection ' + type;
Â  Â  svg.style.position = 'absolute';
Â  Â  svg.style.left = '0';
Â  Â  svg.style.top = '0';
Â  Â  svg.style.width = '100%';
Â  Â  svg.style.height = '100%';
Â  Â Â 
Â  Â  var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
Â  Â Â 
Â  Â  // Calculate cubic bezier control points for a smooth curve
Â  Â  var dx = x2 - x1;
Â  Â  var c1x = x1 + dx * 0.5;
Â  Â  var c1y = y1;
Â  Â  var c2x = x1 + dx * 0.5;
Â  Â  var c2y = y2;

Â  Â  var d = 'M ' + x1 + ' ' + y1 + ' C ' + c1x + ' ' + c1y + ', ' + c2x + ' ' + c2y + ', ' + x2 + ' ' + y2;
Â  Â  path.setAttribute('d', d);
Â  Â Â 
Â  Â  svg.appendChild(path);
Â  Â  canvas.appendChild(svg);
Â  },
Â Â 
Â  addVideos: function(e) {
Â  Â  var self = this;
Â  Â  var files = Array.from(e.target.files);
Â  Â Â 
Â  Â  files.forEach(function(file) {
Â  Â  Â  var url = URL.createObjectURL(file);
Â  Â  Â  self.generateThumb(url).then(function(thumb) {
Â  Â  Â  Â  self.project.assets.videos.push({
Â  Â  Â  Â  Â  id: 'v' + Date.now() + Math.random().toString(36).substr(2,4),
Â  Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  Â  file: file,
Â  Â  Â  Â  Â  url: url,
Â  Â  Â  Â  Â  thumb: thumb
Â  Â  Â  Â  });
Â  Â  Â  Â  self.updateAssetCount();
Â  Â  Â  });
Â  Â  });
Â  Â Â 
Â  Â  this.showStatus('Added ' + files.length + ' video(s)');
Â  },
Â Â 
Â  addImages: function(e) {
Â  Â  var files = Array.from(e.target.files);
Â  Â  var self = this;
Â  Â Â 
Â  Â  files.forEach(function(file) {
Â  Â  Â  var url = URL.createObjectURL(file);
Â  Â  Â  self.project.assets.images.push({
Â  Â  Â  Â  id: 'i' + Date.now() + Math.random().toString(36).substr(2,4),
Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  file: file,
Â  Â  Â  Â  url: url
Â  Â  Â  });
Â  Â  });
Â  Â Â 
Â  Â  this.updateAssetCount();
Â  Â  this.showStatus('Added ' + files.length + ' image(s)');
Â  },
Â Â 
Â  generateThumb: function(videoUrl) {
Â  Â  return new Promise(function(resolve) {
Â  Â  Â  var video = document.createElement('video');
Â  Â  Â  video.src = videoUrl;
Â  Â  Â  video.currentTime = 1;
Â  Â  Â  video.addEventListener('loadeddata', function() {
Â  Â  Â  Â  var canvas = document.createElement('canvas');
Â  Â  Â  Â  canvas.width = 320;
Â  Â  Â  Â  canvas.height = 180;
Â  Â  Â  Â  var ctx = canvas.getContext('2d');
Â  Â  Â  Â  ctx.drawImage(video, 0, 0, 320, 180);
Â  Â  Â  Â  resolve(canvas.toDataURL('image/jpeg', 0.5));
Â  Â  Â  });
Â  Â  Â  video.addEventListener('error', function() {
Â  Â  Â  Â  resolve(null);
Â  Â  Â  });
Â  Â  });
Â  },
Â Â 
Â  updateAssetCount: function() {
Â  Â  document.getElementById('videoCount').textContent = this.project.assets.videos.length;
Â  Â  document.getElementById('imageCount').textContent = this.project.assets.images.length;
Â  },
Â Â 
Â  updateStats: function() {
Â  Â  document.getElementById('nodeCount').textContent = this.project.nodes.length;
Â  Â  this.updateAssetCount();
Â  },
Â Â 
Â  toggleAddMenu: function() {
Â  Â  var opts = document.getElementById('addOptions');
Â  Â  opts.classList.toggle('show');
Â  },
Â Â 
Â  showStatus: function(msg) {
Â  Â  var status = document.getElementById('status');
Â  Â  status.textContent = msg;
Â  Â  status.classList.add('show');
Â  Â  setTimeout(function() { status.classList.remove('show'); }, 3000);
Â  },
Â Â 
Â  // Preview System
Â  preview: function() {
Â  Â  var startNode = this.project.nodes.find(function(n) {Â 
Â  Â  Â  return n.id === App.project.startNode;Â 
Â  Â  });
Â  Â Â 
Â  Â  if(!startNode) {
Â  Â  Â  this.showStatus('Please set a start node first');
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  this.previewState = {
Â  Â  Â  currentNode: startNode,
Â  Â  Â  history: [],
Â  Â  Â  videoTime: 0,
Â  Â  Â  overlayTimer: null,
Â  Â  Â  videoTimeUpdater: null
Â  Â  };
Â  Â Â 
Â  Â  document.getElementById('previewModal').classList.add('show');
Â  Â  document.getElementById('previewTitle').textContent = 'Preview: ' + this.project.title;
Â  Â  this.renderPreviewNode(startNode);
Â  },
Â Â 
Â  renderPreviewNode: function(node) {
Â  Â  var body = document.getElementById('previewBody');
Â  Â  var nav = document.getElementById('previewNav');
Â  Â  var self = this;
Â  Â Â 
Â  Â  // Clear any existing timers/listeners
Â  Â  if(this.previewState.overlayTimer) {
Â  Â  Â  clearInterval(this.previewState.overlayTimer);
Â  Â  Â  this.previewState.overlayTimer = null;
Â  Â  }
Â  Â  var oldVideoEl = document.getElementById('previewVideo');
Â  Â  if (oldVideoEl && this.previewState.videoTimeUpdater) {
Â  Â  Â  Â  oldVideoEl.removeEventListener('timeupdate', this.previewState.videoTimeUpdater);
Â  Â  Â  Â  this.previewState.videoTimeUpdater = null;
Â  Â  }
Â  Â Â 
Â  Â  var html = '';
Â  Â Â 
Â  Â  // Video
Â  Â  if(node.video) {
Â  Â  Â  var videoAsset = this.project.assets.videos.find(function(v) {Â 
Â  Â  Â  Â  return v.id === node.video;Â 
Â  Â  Â  });
Â  Â  Â  if(videoAsset) {
Â  Â  Â  Â  html += '<video class="preview-video" controls autoplay id="previewVideo">';
Â  Â  Â  Â  html += '<source src="' + videoAsset.url + '" type="video/mp4">';
Â  Â  Â  Â  html += '</video>';
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // Text overlay container (shows timed text)
Â  Â  html += '<div class="preview-text-overlay" id="textOverlay"></div>';
Â  Â Â 
Â  Â  html += '<div class="preview-content-section">';
Â  Â Â 
Â  Â  // Images
Â  Â  if(node.images && node.images.length) {
Â  Â  Â  html += '<div class="preview-images">';
Â  Â  Â  for(var i = 0; i < node.images.length; i++) {
Â  Â  Â  Â  var imgAsset = this.project.assets.images.find(function(img) {
Â  Â  Â  Â  Â  return img.id === node.images[i];
Â  Â  Â  Â  });
Â  Â  Â  Â  if(imgAsset) {
Â  Â  Â  Â  Â  html += '<img src="' + imgAsset.url + '">';
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  html += '</div>';
Â  Â  }
Â  Â Â 
Â  Â  // Question
Â  Â  if(node.question) {
Â  Â  Â  html += '<div class="preview-question">' + node.question + '</div>';
Â  Â  }
Â  Â Â 
Â  Â  // Choices
Â  Â  if(node.choices && node.choices.length) {
Â  Â  Â  html += '<div class="preview-choices">';
Â  Â  Â  for(var j = 0; j < node.choices.length; j++) {
Â  Â  Â  Â  var choice = node.choices[j];
Â  Â  Â  Â  html += '<div class="preview-choice" data-choice-idx="' + j + '">';
Â  Â  Â  Â  html += choice.label;
Â  Â  Â  Â  html += '</div>';
Â  Â  Â  }
Â  Â  Â  html += '</div>';
Â  Â  }
Â  Â Â 
Â  Â  html += '</div>';
Â  Â Â 
Â  Â  body.innerHTML = html;
Â  Â Â 
Â  Â  // Setup text overlays timer if there are overlays
Â  Â  var overlayEl = document.getElementById('textOverlay');
Â  Â  var videoEl = document.getElementById('previewVideo');
Â  Â  Â  Â Â 
Â  Â  if(node.textOverlays && node.textOverlays.length > 0) {
Â  Â  Â  Â  var sortedOverlays = node.textOverlays.slice().sort(function(a, b) {
Â  Â  Â  Â  Â  Â  return a.time - b.time;
Â  Â  Â  Â  });
Â  Â  Â  Â  var activeOverlay = null;

Â  Â  Â  Â  var updateOverlays = function(currentTime) {
Â  Â  Â  Â  Â  Â  var overlayToShow = null;
Â  Â  Â  Â  Â  Â  for (var i = 0; i < sortedOverlays.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  var overlay = sortedOverlays[i];
Â  Â  Â  Â  Â  Â  Â  Â  var startTime = parseFloat(overlay.time) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  var duration = parseFloat(overlay.duration) || 3;
Â  Â  Â  Â  Â  Â  Â  Â  var endTime = startTime + duration;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (currentTime >= startTime && currentTime < endTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlayToShow = overlay;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break; // Found the active overlay
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (overlayToShow && overlayToShow !== activeOverlay) {
Â  Â  Â  Â  Â  Â  Â  Â  activeOverlay = overlayToShow;
Â  Â  Â  Â  Â  Â  Â  Â  var overlayContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (overlayToShow.image) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var imgAsset = self.project.assets.images.find(function(i) { return i.id === overlayToShow.image; });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (imgAsset) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlayContent += '<img src="' + imgAsset.url + '">';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (overlayToShow.text) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlayContent += '<div>' + overlayToShow.text + '</div>';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.innerHTML = overlayContent;
Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.style.backgroundColor = overlayToShow.color || 'rgba(0,0,0,0.7)';
Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.classList.add('show');
Â  Â  Â  Â  Â  Â  } else if (!overlayToShow && activeOverlay) {
Â  Â  Â  Â  Â  Â  Â  Â  activeOverlay = null;
Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.classList.remove('show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  if (videoEl) {
Â  Â  Â  Â  Â  Â  this.previewState.videoTimeUpdater = function() {
Â  Â  Â  Â  Â  Â  Â  Â  updateOverlays(videoEl.currentTime);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  videoEl.addEventListener('timeupdate', this.previewState.videoTimeUpdater);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Fallback for nodes without video (uses internal timer)
Â  Â  Â  Â  Â  Â  var sceneTime = 0;
Â  Â  Â  Â  Â  Â  this.previewState.overlayTimer = setInterval(function() {
Â  Â  Â  Â  Â  Â  Â  Â  sceneTime += 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  updateOverlays(sceneTime);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  var nodeDuration = parseFloat(node.duration) || 10;
Â  Â  Â  Â  Â  Â  Â  Â  if(sceneTime > nodeDuration) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(self.previewState.overlayTimer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.previewState.overlayTimer = null;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // Add choice click handlers
Â  Â  var choiceEls = body.querySelectorAll('.preview-choice');
Â  Â  for(var k = 0; k < choiceEls.length; k++) {
Â  Â  Â  choiceEls[k].addEventListener('click', function(e) {
Â  Â  Â  Â  var idx = parseInt(e.target.getAttribute('data-choice-idx'));
Â  Â  Â  Â  self.handlePreviewChoice(node, idx);
Â  Â  Â  });
Â  Â  }
Â  Â Â 
Â  Â  // Navigation buttons
Â  Â  var navHtml = '';
Â  Â Â 
Â  Â  if(this.previewState.history.length > 0) {
Â  Â  Â  navHtml += '<button class="btn secondary" onclick="App.previewBack()">â† Back</button>';
Â  Â  }
Â  Â Â 
Â  Â  if(node.type === 'end') {
Â  Â  Â  navHtml += '<button class="btn" onclick="App.restartPreview()">Restart</button>';
Â  Â  } else if(!node.choices || node.choices.length === 0) {
Â  Â  Â  if(node.defaultNext) {
Â  Â  Â  Â  navHtml += '<button class="btn" onclick="App.previewNext()">Continue â†’</button>';
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  nav.innerHTML = navHtml;
Â  },
Â Â 
Â  handlePreviewChoice: function(node, idx) {
Â  Â  var choice = node.choices[idx];
Â  Â  var choiceEls = document.querySelectorAll('.preview-choice');
Â  Â Â 
Â  Â  // Show correct/incorrect
Â  Â  for(var i = 0; i < choiceEls.length; i++) {
Â  Â  Â  if(i === idx) {
Â  Â  Â  Â  choiceEls[i].classList.add(choice.correct ? 'correct' : 'incorrect');
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // Navigate after delay
Â  Â  var self = this;
Â  Â  setTimeout(function() {
Â  Â  Â  self.previewState.history.push(node.id);
Â  Â  Â Â 
Â  Â  Â  var nextId = choice.target || node.defaultNext;
Â  Â  Â  if(nextId) {
Â  Â  Â  Â  var nextNode = self.project.nodes.find(function(n) {Â 
Â  Â  Â  Â  Â  return n.id === nextId;Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  if(nextNode) {
Â  Â  Â  Â  Â  self.previewState.currentNode = nextNode;
Â  Â  Â  Â  Â  self.renderPreviewNode(nextNode);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  self.closePreview();
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  self.closePreview();
Â  Â  Â  }
Â  Â  }, 1000);
Â  },
Â Â 
Â  previewNext: function() {
Â  Â  if(!this.previewState.currentNode || !this.previewState.currentNode.defaultNext) return;
Â  Â Â 
Â  Â  this.previewState.history.push(this.previewState.currentNode.id);
Â  Â  var nextNode = this.project.nodes.find(function(n) {Â 
Â  Â  Â  return n.id === App.previewState.currentNode.defaultNext;Â 
Â  Â  });
Â  Â Â 
Â  Â  if(nextNode) {
Â  Â  Â  this.previewState.currentNode = nextNode;
Â  Â  Â  this.renderPreviewNode(nextNode);
Â  Â  }
Â  },
Â Â 
Â  previewBack: function() {
Â  Â  if(this.previewState.history.length === 0) return;
Â  Â Â 
Â  Â  var prevId = this.previewState.history.pop();
Â  Â  var prevNode = this.project.nodes.find(function(n) {Â 
Â  Â  Â  return n.id === prevId;Â 
Â  Â  });
Â  Â Â 
Â  Â  if(prevNode) {
Â  Â  Â  this.previewState.currentNode = prevNode;
Â  Â  Â  this.renderPreviewNode(prevNode);
Â  Â  }
Â  },
Â Â 
Â  restartPreview: function() {
Â  Â  var startNode = this.project.nodes.find(function(n) {Â 
Â  Â  Â  return n.id === App.project.startNode;Â 
Â  Â  });
Â  Â Â 
Â  Â  if(startNode) {
Â  Â  Â  // Must clear timers from previous run
Â  Â  Â  if(this.previewState.overlayTimer) {
Â  Â  Â  Â  Â  clearInterval(this.previewState.overlayTimer);
Â  Â  Â  }
Â  Â  Â  var oldVideoEl = document.getElementById('previewVideo');
Â  Â  Â  if (oldVideoEl && this.previewState.videoTimeUpdater) {
Â  Â  Â  Â  Â  oldVideoEl.removeEventListener('timeupdate', this.previewState.videoTimeUpdater);
Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  this.previewState = {
Â  Â  Â  Â  currentNode: startNode,
Â  Â  Â  Â  history: [],
Â  Â  Â  Â  videoTime: 0,
Â  Â  Â  Â  overlayTimer: null,
Â  Â  Â  Â  videoTimeUpdater: null
Â  Â  Â  };
Â  Â  Â  this.renderPreviewNode(startNode);
Â  Â  }
Â  },
Â Â 
Â  closePreview: function() {
Â  Â  document.getElementById('previewModal').classList.remove('show');
Â  Â Â 
Â  Â  // Clear timers and listeners
Â  Â  if(this.previewState.overlayTimer) {
Â  Â  Â  clearInterval(this.previewState.overlayTimer);
Â  Â  Â  this.previewState.overlayTimer = null;
Â  Â  }
Â  Â Â 
Â  Â  var videoEl = document.getElementById('previewVideo');
Â  Â  if (videoEl && this.previewState.videoTimeUpdater) {
Â  Â  Â  Â  Â videoEl.removeEventListener('timeupdate', this.previewState.videoTimeUpdater);
Â  Â  Â  Â  Â this.previewState.videoTimeUpdater = null;
Â  Â  }
Â  Â Â 
Â  Â  // Pause any playing videos
Â  Â  var videos = document.querySelectorAll('.preview-video');
Â  Â  for(var i = 0; i < videos.length; i++) {
Â  Â  Â  videos[i].pause();
Â  Â  }
Â  },
Â Â 
Â  save: function() {
Â  Â  var defaultName = this.project.title.replace(/[^a-z0-9]/gi, '_') + '.lxr';
Â  Â  var fileName = prompt('Enter filename:', defaultName);
Â  Â  if(!fileName) return; // User cancelled
Â  Â  Â  Â  Â  Â Â 
Â  Â  var data = JSON.stringify(this.project, null, 2);
Â  Â  var blob = new Blob([data], {type: 'application/json'});
Â  Â  var a = document.createElement('a');
Â  Â  a.href = URL.createObjectURL(blob);
Â  Â  a.download = fileName.endsWith('.lxr') ? fileName : fileName + '.lxr';
Â  Â  a.click();
Â  Â  this.showStatus('Project saved as ' + a.download);
Â  },
Â Â 
Â  load: function() {
Â  Â  document.getElementById('loader').click();
Â  },
Â Â 
Â  loadFile: function(e) {
Â  Â  var file = e.target.files[0];
Â  Â  if(!file) return;
Â  Â Â 
Â  Â  var self = this;
Â  Â  var reader = new FileReader();
Â  Â  reader.onload = function(e) {
Â  Â  Â  try {
Â  Â  Â  Â  self.project = JSON.parse(e.target.result);
Â  Â  Â  Â  document.getElementById('projectTitle').value = self.project.title;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ensure backward compatibility
Â  Â  Â  Â  self.project.nodes.forEach(function(node) {
Â  Â  Â  Â  Â  if(!node.textOverlays) node.textOverlays = [];
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Ensure new fields exist on loaded overlays
Â  Â  Â  Â  Â  node.textOverlays.forEach(function(overlay) {
Â  Â  Â  Â  Â  Â  Â if(overlay.duration === undefined) overlay.duration = 3;
Â  Â  Â  Â  Â  Â  Â if(overlay.image === undefined) overlay.image = null;
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if(!node.defaultNext && node.nextNode) {
Â  Â  Â  Â  Â  Â  node.defaultNext = node.nextNode;
Â  Â  Â  Â  Â  Â  delete node.nextNode;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('canvas').innerHTML = '';
Â  Â  Â  Â  self.project.nodes.forEach(function(node) {
Â  Â  Â  Â  Â  self.createNodeElement(node);
Â  Â  Â  Â  });
Â  Â  Â  Â  self.updateCanvas();
Â  Â  Â  Â  self.updateStats();
Â  Â  Â  Â  self.deselect();
Â  Â  Â  Â  self.showStatus('Project loaded');
Â  Â  Â  } catch(err) {
Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  alert('Invalid project file');
Â  Â  Â  }
Â  Â  };
Â  Â  reader.readAsText(file);
Â  },
Â Â 
Â  export: function() {
Â  Â  var self = this;
Â  Â  var defaultName = this.project.title.replace(/[^a-z0-9]/gi, '_') + '_webxr.zip';
Â  Â  var fileName = prompt('Enter export filename:', defaultName);
Â  Â  if(!fileName) return; // User cancelled
Â  Â Â 
Â  Â  var zip = new JSZip();
Â  Â Â 
Â  Â  var html = this.generateWebXR();
Â  Â  zip.file('index.html', html);
Â  Â Â 
Â  Â  var assetsFolder = zip.folder('assets');
Â  Â  this.project.assets.videos.forEach(function(video) {
Â  Â  Â  if(video.file) assetsFolder.file(video.name, video.file);
Â  Â  });
Â  Â  this.project.assets.images.forEach(function(img) {
Â  Â  Â  if(img.file) assetsFolder.file(img.name, img.file);
Â  Â  });
Â  Â Â 
Â  Â  zip.generateAsync({type: 'blob'}).then(function(blob) {
Â  Â  Â  var a = document.createElement('a');
Â  Â  Â  a.href = URL.createObjectURL(blob);
Â  Â  Â  a.download = fileName.endsWith('.zip') ? fileName : fileName + '.zip';
Â  Â  Â  a.click();
Â  Â  Â  self.showStatus('WebXR package exported as ' + a.download);
Â  Â  });
Â  },
Â Â 
Â  generateWebXR: function() {
Â  Â  // This function creates a simplified A-Frame HTML file for export
Â  Â  // It now passes the full project spec, including text overlays with duration/image
Â  Â Â 
Â  Â  var videoAssets = this.project.assets.videos.map(function(v) {
Â  Â  Â  return '<video id="' + v.id + '" src="assets/' + v.name + '" crossorigin></video>';
Â  Â  }).join('\n Â  Â  Â  Â ');
Â  Â Â 
Â  Â  var imageAssets = this.project.assets.images.map(function(i) {
Â  Â  Â  return '<img id="' + i.id + '" src="assets/' + i.name + '" crossorigin>';
Â  Â  }).join('\n Â  Â  Â  Â ');
Â  Â Â 
Â  Â  // Create a version of the project with asset files removed, as they won't be in the JSON
Â  Â  var exportProject = JSON.parse(JSON.stringify(this.project));
Â  Â  exportProject.assets.videos.forEach(function(v) {Â 
Â  Â  Â  Â  v.file = v.name; // Replace file blob with name
Â  Â  Â  Â  v.url = "assets/" + v.name;
Â  Â  Â  Â  v.thumb = null; // Thumbs are not needed in exported pack
Â  Â  });
Â  Â  exportProject.assets.images.forEach(function(i) {
Â  Â  Â  Â  i.file = i.name; // Replace file blob with name
Â  Â  Â  Â  i.url = "assets/" + i.name;
Â  Â  });
Â  Â Â 
Â  Â  return '<!DOCTYPE html>\n' +
Â  Â  Â  '<html>\n' +
Â  Â  Â  '<head>\n' +
Â  Â  Â  ' Â <meta charset="utf-8">\n' +
Â  Â  Â  ' Â <title>' + this.project.title + '</title>\n' +
Â  Â  Â  ' Â <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></' + 'script>\n' +
Â  Â  Â  '</head>\n' +
Â  Â  Â  '<body>\n' +
Â  Â  Â  ' Â <a-scene>\n' +
Â  Â  Â  ' Â  Â <a-assets>\n' +
Â  Â  Â  ' Â  Â  Â ' + videoAssets + '\n' +
Â  Â  Â  ' Â  Â  Â ' + imageAssets + '\n' +
Â  Â  Â  ' Â  Â </a-assets>\n' +
Â  Â  Â  ' Â  Â \n' +
Â  Â  Â  ' Â  Â <a-sky id="sky"></a-sky>\n' +
Â  Â  Â  ' Â  Â <a-camera>\n' +
Â  Â  Â  ' Â  Â  Â <a-cursor></a-cursor>\n' +
Â  Â  Â  ' Â  Â </a-camera>\n' +
Â  Â  Â  ' Â  Â \n' +
Â  Â  Â  ' Â  Â <script>\n' +
Â  Â  Â  ' Â  Â  Â const flow = ' + JSON.stringify(exportProject) + ';\n' +
Â  Â  Â  ' Â  Â  Â console.log("LÃ¦rbarXR Scene Loaded", flow);\n' +
Â  Â  Â  ' Â  Â  Â // WebXR runtime implementation would go here\n' +
Â  Â  Â  ' Â  Â  Â // It would use the `flow` object to manage scenes, overlays, and navigation\n' +
Â  Â  Â  ' Â  Â </' + 'script>\n' +
Â  Â  Â  ' Â </a-scene>\n' +
Â  Â  Â  '</body>\n' +
Â  Â  Â  '</html>';
Â  }
};

window.addEventListener('DOMContentLoaded', function() { App.init(); });
</script>
</body>
</html>
 
